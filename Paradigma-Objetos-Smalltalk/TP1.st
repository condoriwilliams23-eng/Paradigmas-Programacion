Object subclass: #CentroTrasplantes	instanceVariableNames: 'nombre listaPacientes listaDonantes evaluador resultados'	classVariableNames: ''	package: 'TP1'!!CentroTrasplantes methodsFor: 'Acceder y Manipular' stamp: 'Eros 10/5/2025 18:14'!agregaPaciente: unaPersona fechaIngreso: unaFecha|dniRepetido|dniRepetido := false. listaPacientes do: [ :paciente |		(paciente dni = unaPersona dni) ifTrue: [ dniRepetido := true ]. 		 ].listaDonantes  do: [ :donante |		(donante dni = unaPersona dni) ifTrue: [ dniRepetido := true ]. 		 ].dniRepetido ifFalse: [ 		listaPacientes add: unaPersona. 	unaPersona fechaIngresoListaEspera: unaFecha. 		 ] ifTrue: [ ^ 'Dni repetido' ]. ! !!CentroTrasplantes methodsFor: 'Acceder y Manipular' stamp: 'Eros 10/5/2025 13:56'!asociaPaciente: unaPersona conDonante: otraPersona(listaPacientes includes: unaPersona) ifTrue:  [ 		(listaDonantes includes: otraPersona) ifTrue:  [ 				unaPersona donanteAsociado: otraPersona. 				 ] ifFalse:  [ ^'El donante no se encuentra registrado' ].		 ] ifFalse: [ ' El paciente no se encuentra registrado' ]. ! !!CentroTrasplantes methodsFor: 'Acceder y Manipular' stamp: 'miqueas 10/5/2025 19:10'!agregaDonante: unaPersona|dniRepetido|dniRepetido := false. listaPacientes do: [ :paciente |		(paciente dni = unaPersona dni) ifTrue: [ dniRepetido := true ]. 		 ].listaDonantes  do: [ :donante |		(donante dni = unaPersona dni) ifTrue: [ dniRepetido := true ]. 		 ].dniRepetido ifFalse: [ 		listaDonantes add: unaPersona. 		 ] ifTrue: [ ^ 'Dni repetido' ]. ! !!CentroTrasplantes methodsFor: 'Guardar Registros' stamp: 'Marcos 10/20/2025 22:05'!guardaRegistros: prefijoNombreArchivo    | archivoPacientes archivoDonantes archivoCompatibilidades hoy procesadosDonantes |    hoy := Date today.    "=== 1) pacientes: dni,nombre,apellido,mesesEnListaEspera ==="    archivoPacientes := (prefijoNombreArchivo , '_pacientes.csv') asFileReference writeStream.    [        "archivoPacientes nextPutAll: 'dni,nombre,apellido,mesesEnListaEspera'; cr."        listaPacientes do: [:p |            | meses |            meses := (p fechaIngresoListaEspera isNil)                ifTrue: [ 0 ]                ifFalse: [                    | fi m |                    fi := p fechaIngresoListaEspera.                    "meses completos en lista: (año/mes) con ajuste por día"                    m := (hoy year - fi year) * 12 + (hoy monthIndex - fi monthIndex).                    (hoy dayOfMonth < fi dayOfMonth) ifTrue: [ m := m - 1 ].                    (m max: 0)                ].            archivoPacientes                nextPutAll: p dni asString; nextPut: $,;                nextPutAll: p nombre; nextPut: $,;                nextPutAll: p apellido; nextPut: $,;                nextPutAll: meses asString; cr        ].    ] ensure: [ archivoPacientes close ].    "=== 2) donantes asociados: dniDonante,nombre,apellido,dniPacienteAsociado ==="    archivoDonantes := (prefijoNombreArchivo , '_donantes.csv') asFileReference writeStream.    [        "archivoDonantes nextPutAll: 'dniDonante,nombre,apellido,dniPacienteAsociado'; cr."        "evitar duplicados si un mismo donante apareciera más de una vez"        procesadosDonantes := Set new.        listaPacientes do: [:p |            | d |            d := p donanteAsociado.            (d notNil and: [ (procesadosDonantes includes: d dni) not ]) ifTrue: [                archivoDonantes                    nextPutAll: d dni asString; nextPut: $,;                    nextPutAll: d nombre;        nextPut: $,;                    nextPutAll: d apellido;      nextPut: $,;                    nextPutAll: p dni asString;  cr.                procesadosDonantes add: d dni            ].        ].    ] ensure: [ archivoDonantes close ].    "=== 3) compatibilidades aptas: dniPaciente,dniDonante,porcentajeCompatibilidad ==="    archivoCompatibilidades := (prefijoNombreArchivo , '_compatibilidades.csv') asFileReference writeStream.    [        "archivoCompatibilidades nextPutAll: 'dniPaciente,dniDonante,porcentajeCompatibilidad'; cr."        resultados do: [:r |            r compatible ifTrue: [                archivoCompatibilidades                    nextPutAll: r paciente dni asString; nextPut: $,;                    nextPutAll: r donante  dni asString; nextPut: $,;                    nextPutAll: r porcentajeCompatibilidad asString; cr            ].        ].    ] ensure: [ archivoCompatibilidades close ].! !!CentroTrasplantes methodsFor: 'Calculo de Compatibilidad' stamp: 'Marcos 10/20/2025 22:02'!calculaCompatibilidadesRegistrados    resultados := OrderedCollection new.  "← Limpia los anteriores"    listaPacientes do: [:paciente |        self compatibilidad: paciente con: (paciente donanteAsociado).    ].! !!CentroTrasplantes methodsFor: 'Calculo de Compatibilidad' stamp: 'Marcos 10/5/2025 12:19'!evaluadorCompatibilidad: unEvaluadorCompatibilidad 	evaluador:= unEvaluadorCompatibilidad.	resultados:= OrderedCollection new.! !!CentroTrasplantes methodsFor: 'Calculo de Compatibilidad' stamp: 'Marcos 10/20/2025 22:02'!calculaCompatibilidadesGeneral    resultados := OrderedCollection new.    listaPacientes do: [:paciente |        listaDonantes do: [:donante |            self compatibilidad: paciente con: donante.        ].    ].! !!CentroTrasplantes methodsFor: 'Calculo de Compatibilidad' stamp: 'Eros 10/5/2025 13:49'!compatibilidad: unPaciente con: unDonante		| resultado |		(evaluador isNil)ifTrue:[		^self error: 'no se definió ningún evaluador'.	]ifFalse:[		resultado:= evaluador compatibilidadPaciente: unPaciente con: unDonante.		resultados add: resultado.	].^resultado.! !!CentroTrasplantes methodsFor: 'initialization' stamp: 'ErosFaccioli 10/2/2025 18:47'!initialize: nombreDelCentronombre:= nombreDelCentro.listaPacientes := OrderedCollection new. listaDonantes := OrderedCollection new. ! !!CentroTrasplantes methodsFor: 'as yet unclassified' stamp: 'MarcosLupotti 11/4/2025 17:32'!guardaBaseDeDatosProlog	| archivo ruta hoy |	"Saco fecha de hoy"	hoy := Date today.		ruta := (nombre , '.pl') asFileReference.	archivo := ruta writeStream.		[		"Guardar Pacientes"		archivo nextPutAll: '% === PACIENTES ==='; cr; cr.				listaPacientes do: [:p |			| meses |						meses := (p fechaIngresoListaEspera isNil)				ifTrue: [ 0 ]				ifFalse: [					| fi m |					fi := p fechaIngresoListaEspera.					m := (hoy year - fi year) * 12 + (hoy monthIndex - fi monthIndex).					(hoy dayOfMonth < fi dayOfMonth) ifTrue: [ m := m - 1 ].					(m max: 0)				].			"Escribimos el hecho Prolog: paciente(dni(DNI), nombre(Nombre, Apellido), tiempo_espera(Meses))."			archivo 				nextPutAll: 'paciente(dni('; print: p dni;				nextPutAll: '), nombre("'; nextPutAll: p nombre;				nextPutAll: '", "'; nextPutAll: p apellido;				nextPutAll: '"), tiempo_espera('; print: meses;				nextPutAll: ')).'; cr.		].		archivo cr; nextPutAll: '% === DONANTES ==='; cr; cr.		listaPacientes do: [:p |			| d |			d := p donanteAsociado.			(d notNil) ifTrue: [ 				"Hecho de Prolog: donante(dni(DNI), nombre(Nombre, Apellido), dni_paciente(DNI_Paciente))."				archivo					nextPutAll: 'donante(dni('; print: d dni;					nextPutAll: '), nombre("'; nextPutAll: d nombre;					nextPutAll: '", "'; nextPutAll: d apellido;					nextPutAll: '"), dni_paciente('; print: p dni;					nextPutAll: ')).'; cr.			]		].		"Guardar Compatibilidades"		archivo cr; nextPutAll: '% === COMPATIBILIDADES ==='; cr; cr.		"Guardamos TODOS los resultados"		resultados do: [ :r |			archivo				nextPutAll: 'compatibilidad(';				print: r donante dni;				nextPutAll: ', ';				print: r paciente dni;				nextPutAll: ', ';				print: r porcentajeCompatibilidad;				nextPutAll: ').'; cr.		].			] ensure: [ archivo close ].! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!CentroTrasplantes class	instanceVariableNames: ''!!CentroTrasplantes class methodsFor: 'Creación Instancia' stamp: 'Marcos 10/5/2025 12:03'!conNombre: nombreDelCentro^(super new) initialize: nombreDelCentro. ! !Object subclass: #Criterio	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!Criterio methodsFor: 'abstract' stamp: 'MarcosLupotti 9/26/2025 16:58'!evaluaCompatibilidad: unPaciente con: unDonante 	self subclassResponsibility.! !!Criterio methodsFor: 'abstract' stamp: 'MarcosLupotti 9/26/2025 16:58'!estudiosFaltantes: unPaciente con: unDonante	self subclassResponsibility.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Criterio class	instanceVariableNames: ''!!Criterio class methodsFor: 'Creación Instancia' stamp: 'Eros 10/5/2025 23:38'!new^super new. ! !Criterio subclass: #CriterioDeseable	instanceVariableNames: 'ponderacion'	classVariableNames: ''	package: 'TP1'!!CriterioDeseable methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 16:55'!ponderacion: unaPonderacion	ponderacion:= unaPonderacion.^self.! !!CriterioDeseable methodsFor: 'accessing' stamp: 'Marcos 10/4/2025 18:54'!ponderacion	^ponderacion.! !CriterioDeseable subclass: #CriterioEdad	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!CriterioEdad methodsFor: 'abstract' stamp: 'Eros 10/5/2025 22:59'!evaluaCompatibilidad: unPaciente con: unDonante	| diferencia porcentaje |	diferencia := ((unDonante edad - unPaciente edad) abs).		porcentaje := (0 max: (1 - (diferencia / 30))) * 100.		^porcentaje! !!CriterioEdad methodsFor: 'abstract' stamp: 'Eros 10/20/2025 09:46'!estudiosFaltantes: unPaciente con: unDonante^OrderedCollection new. ! !CriterioDeseable subclass: #CriterioHLA	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!CriterioHLA methodsFor: 'abstract' stamp: 'Eros 10/20/2025 11:24'!evaluaCompatibilidad: unPaciente con: unDonante    | estPaciente estDonante coincidencia total porcentaje |        estPaciente := (unPaciente estudios) detect: [ :e | e isKindOf: EstudioTipificacionHLA ].    estDonante := (unDonante estudios) detect: [ :e | e isKindOf: EstudioTipificacionHLA ].    coincidencia := 0.    total := 6. "Siempre 6 alelos posibles (2 por locus A, B, DR)"    "REGLA: Contar alelos del DONANTE presentes en el PACIENTE"        estDonante a do: [:alelo |        (estPaciente a includes: alelo) ifTrue: [ coincidencia := coincidencia + 1 ] ].        estDonante b do: [:alelo |        (estPaciente b includes: alelo) ifTrue: [ coincidencia := coincidencia + 1 ] ].        estDonante dR do: [:alelo |        (estPaciente dR includes: alelo) ifTrue: [ coincidencia := coincidencia + 1 ] ].    "Calculo el porcentaje"    porcentaje := ((coincidencia / total) * 100) asFloat.    ^ porcentaje! !!CriterioHLA methodsFor: 'abstract' stamp: 'Eros 10/20/2025 09:46'!estudiosFaltantes: unPaciente con: unDonante    | estFaltantes |    estFaltantes := OrderedCollection new.        (unPaciente estudios detect: [:e | e isKindOf: EstudioTipificacionHLA] ifNone: [nil]) isNil ifTrue: [        estFaltantes add: 'EstudioTipificacionHLA (Paciente)'.    ].        (unDonante estudios detect: [:e | e isKindOf: EstudioTipificacionHLA] ifNone: [nil]) isNil ifTrue: [        estFaltantes add: 'EstudioTipificacionHLA (Donante)'.    ].        ^ estFaltantes! !Criterio subclass: #CriterioObligatorio	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!CriterioObligatorio subclass: #CriterioABO	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!CriterioABO methodsFor: 'abstract' stamp: 'miqueas 10/5/2025 20:01'!evaluaCompatibilidad: unPaciente con: unDonante	| estPaciente estDonante tipoPaciente tipoDonante estado |.	estPaciente:= (unPaciente estudios) detect: [ :e | e isKindOf: AnalisisDeSangre].	estDonante:= (unDonante estudios) detect: [ :e | e isKindOf: AnalisisDeSangre].	tipoPaciente:= estPaciente resultado.	tipoDonante:= estDonante resultado.		estado:= #noApto.	(tipoDonante = #O) ifTrue:[ estado:= #apto].	(tipoDonante = #A  and: [tipoPaciente = #A or: [tipoPaciente = #AB]]) ifTrue:[ estado:= #apto].	(tipoDonante = #B  and: [tipoPaciente = #B or: [tipoPaciente = #AB]] ) ifTrue:[ estado:= #apto].	(tipoDonante = #AB and: [tipoPaciente = #AB] ) ifTrue:[ estado:= #apto].^estado.! !!CriterioABO methodsFor: 'abstract' stamp: 'Eros 10/5/2025 18:07'!estudiosFaltantes: unPaciente con: unDonante	| estPaciente estDonante estFaltante |.		estPaciente:= (unPaciente estudios) detect: [ :e | e isKindOf: AnalisisDeSangre]	ifNone:[estFaltante:= 'AnalisisDeSangre'].	estDonante:= (unDonante estudios) detect: [ :e | e isKindOf: AnalisisDeSangre]	ifNone:[estFaltante:= 'AnalisisDeSangre'].		(estFaltante isNil) ifTrue:[^OrderedCollection new]. "No falta nada"	^((OrderedCollection new) add:estFaltante; yourself) "retorna lista con el estudio faltante"! !CriterioObligatorio subclass: #CriterioAptitudGeneral	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!CriterioAptitudGeneral methodsFor: 'abstract' stamp: 'MarcosLupotti 9/26/2025 18:55'!evaluaCompatibilidad: unPaciente con: unDonante	| estPaciente |.	estPaciente:= (unPaciente estudios) detect: [ :e | e isKindOf: EstudioAptitudGeneral].^(estPaciente resultado). "Regla: el resultado del estudio debe ser #apto"! !!CriterioAptitudGeneral methodsFor: 'abstract' stamp: 'Eros 10/5/2025 18:08'!estudiosFaltantes: unPaciente con: unDonante	| estPaciente estFaltante |.	estPaciente:= (unPaciente estudios) detect: [ :e | e isKindOf: EstudioAptitudGeneral]	ifNone:[estFaltante:= 'EstudioAptitudGeneral'].		(estFaltante isNil) ifTrue:[^OrderedCollection new]. "No falta nada"	^((OrderedCollection new) add:estFaltante; yourself) "retorna lista con el estudio faltante"! !CriterioObligatorio subclass: #CriterioCrossmatch	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!CriterioCrossmatch methodsFor: 'abstract' stamp: 'Eros 10/5/2025 18:04'!evaluaCompatibilidad: unPaciente con: unDonante	| estCross resultado estado |.	estCross:= (unPaciente estudios) detect: [ :e | (e isKindOf: EstudioCrossmatch) and:[e donante = unDonante]].	resultado:= estCross resultado.	(resultado = #positivo) ifTrue:[estado:= #noApto].	(resultado = #negativo) ifTrue:[estado:= #apto].	^estado.	! !!CriterioCrossmatch methodsFor: 'abstract' stamp: 'miqueas 10/5/2025 20:16'!estudiosFaltantes: unPaciente con: unDonante	| estPaciente estFaltante |.	estPaciente:= (unPaciente estudios) detect: [ :e | (e isKindOf: EstudioCrossmatch) and:[e donante = unDonante]]	ifNone:[estFaltante:= 'EstudioCrossmatch'].		(estFaltante isNil) ifTrue:[^OrderedCollection new]. "No falta nada"	^((OrderedCollection new) add:estFaltante; yourself) "retorna lista con el estudio faltante"! !CriterioDeseable subclass: #CriterioPRA	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!CriterioPRA methodsFor: 'abstract' stamp: 'Eros 10/5/2025 22:51'!evaluaCompatibilidad: unPaciente con: unDonante	| estudio suma porcentaje alelosDonante |	"Busco el estudio PRA del paciente"	estudio := (unPaciente estudios) detect: [ :e | e isKindOf: EstudioAnticuerposPRA ]		ifNone: [ ^0 ].  "Si no tiene el estudio, devuelvo 0 (no evaluable)"	"Obtengo los alelos tipificados del donante"	alelosDonante := unDonante estudios		detect: [ :e | e isKindOf: EstudioTipificacionHLA ]		ifNone: [ ^0 ].	"Calculo la suma de reactividades solo para los alelos que están en el donante"	suma := 0.	estudio reactividades keysAndValuesDo: [ :alelo :valor |		(alelosDonante alelos includes: alelo) ifTrue: [			suma := suma + valor		]	].	"Aplico la regla: porcentaje = max(0, 100 - suma)"	porcentaje := 100 - suma.	porcentaje < 0 ifTrue: [ porcentaje := 0 ].	^porcentaje! !!CriterioPRA methodsFor: 'abstract' stamp: 'Eros 10/20/2025 09:48'!estudiosFaltantes: unPaciente con: unDonante    | estFaltantes |    estFaltantes := OrderedCollection new.        (unPaciente estudios detect: [:e | e isKindOf: EstudioAnticuerposPRA] ifNone: [nil]) isNil ifTrue: [        estFaltantes add: 'EstudioAnticuerposPRA (Paciente)'.    ].        (unDonante estudios detect: [:e | e isKindOf: EstudioTipificacionHLA] ifNone: [nil]) isNil ifTrue: [        estFaltantes add: 'EstudioTipificacionHLA (Donante)'.    ].        ^ estFaltantes! !CriterioObligatorio subclass: #CriterioSerologias	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!CriterioSerologias methodsFor: 'abstract' stamp: 'MarcosLupotti 9/26/2025 18:52'!evaluaCompatibilidad: unPaciente con: unDonante	| estPaciente estDonante  estado |.	estPaciente:= (unPaciente estudios) detect: [ :e | e isKindOf: EstudioSerologicoCompleto].	estDonante:= (unDonante estudios) detect: [ :e | e isKindOf: EstudioSerologicoCompleto].		estado:= #noApto.	((estPaciente resultado = #apto) and:[(estDonante resultado = #apto)])	ifTrue:[estado:= #apto].^estado.	! !!CriterioSerologias methodsFor: 'abstract' stamp: 'Eros 10/5/2025 18:08'!estudiosFaltantes: unPaciente con: unDonante	| estPaciente estDonante estFaltante |.		estPaciente:= (unPaciente estudios) detect: [ :e | e isKindOf: EstudioSerologicoCompleto]	ifNone:[estFaltante:= 'EstudioSerologicoCompleto'].	estDonante:= (unDonante estudios) detect: [ :e | e isKindOf: EstudioSerologicoCompleto]	ifNone:[estFaltante:= 'EstudioSerologicoCompleto'].		(estFaltante isNil) ifTrue:[^OrderedCollection new]. "No falta nada"	^((OrderedCollection new) add:estFaltante; yourself) "retorna lista con el estudio faltante"! !CriterioDeseable subclass: #CriterioTamanoCorporal	instanceVariableNames: ''	classVariableNames: ''	package: 'TP1'!!CriterioTamanoCorporal methodsFor: 'abstract' stamp: 'Eros 10/5/2025 22:38'!evaluaCompatibilidad: unPaciente con: unDonante	| diferencia imcDonante imcPaciente porcentaje|		imcPaciente := unPaciente peso / (unPaciente estatura * unPaciente estatura).	imcDonante := unDonante peso / (unDonante estatura * unDonante estatura).		diferencia := ((imcDonante - imcPaciente) abs).		porcentaje := ((1- (diferencia /10)) max:0) *100. 		^porcentaje. ! !!CriterioTamanoCorporal methodsFor: 'abstract' stamp: 'Eros 10/20/2025 09:48'!estudiosFaltantes: unPaciente con: unDonante^OrderedCollection new! !Object subclass: #EstudioClinico	instanceVariableNames: 'fecha'	classVariableNames: ''	package: 'TP1'!!EstudioClinico methodsFor: 'initialization' stamp: 'miqueas 10/5/2025 20:41'!initialize	super initialize.	fecha := Date today.! !!EstudioClinico methodsFor: 'accessing' stamp: 'miqueas 10/5/2025 20:40'!fecha: unaFecha	fecha := unaFecha! !!EstudioClinico methodsFor: 'accessing' stamp: 'miqueas 10/5/2025 20:40'!fecha^ fecha! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!EstudioClinico class	instanceVariableNames: 'instance creation'!!EstudioClinico class methodsFor: 'as yet unclassified' stamp: 'willy 9/20/2025 19:46'!conResultado: unResultado	 ^self new resultado: unResultado; yourself ! !!EstudioClinico class methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 20:37'!conFecha: unaFecha resultado: unResultado 	^self new fecha: unaFecha  resultado: unResultado; yourself  ! !EstudioClinico subclass: #AnalisisDeSangre	instanceVariableNames: 'grupoSanguineo'	classVariableNames: ''	package: 'TP1'!!AnalisisDeSangre methodsFor: 'accessing' stamp: 'Marcos 10/5/2025 21:31'!resultado	^grupoSanguineo.! !!AnalisisDeSangre methodsFor: 'accessing' stamp: 'miqueas 10/5/2025 20:51'!grupoSanguineo: unGrupo	"Setter: valida y asigna el grupo sanguíneo."	(#(A B AB O) includes: unGrupo) "No es necesario el # antes de los símbolos dentro de un literal array"		ifTrue: [ grupoSanguineo := unGrupo ]		ifFalse: [ self error: 'Grupo sanguíneo inválido.' ].! !!AnalisisDeSangre methodsFor: 'accessing' stamp: 'miqueas 10/5/2025 20:50'!grupoSanguineo	^grupoSanguineo.! !!AnalisisDeSangre methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 18:58'!initialize: unGrupo	(#(#A #B #AB #O) includes: unGrupo) ifTrue:[		grupoSanguineo:= unGrupo.	]ifFalse: [^self error: 'Dato mal ingresado'].^self.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!AnalisisDeSangre class	instanceVariableNames: ''!!AnalisisDeSangre class methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 19:25'!conGrupoSanguineo: unGrupo	^(super new) initialize: unGrupo; yourself.! !EstudioClinico subclass: #EstudioAnticuerposPRA	instanceVariableNames: 'reactividades'	classVariableNames: ''	package: 'TP1'!!EstudioAnticuerposPRA methodsFor: 'accessing' stamp: 'Anonymous 10/5/2025 00:21'!reactividades	^ reactividades! !!EstudioAnticuerposPRA methodsFor: 'accessing' stamp: 'Anonymous 10/5/2025 00:21'!porcentajePRA	"Devuelve el porcentaje total de reactividad"	| total |	total := 0.	self reactividades valuesDo: [:v | total := total + v ].	^ (total / self reactividades size) asFloat.! !!EstudioAnticuerposPRA methodsFor: 'accessing' stamp: 'Anonymous 10/5/2025 00:21'!reactividades: anObject	reactividades := anObject! !!EstudioAnticuerposPRA methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 18:58'!initialize: unDiccionario	self reactividades: unDiccionario.^self.! !!EstudioAnticuerposPRA methodsFor: 'as yet unclassified' stamp: 'Anonymous 10/5/2025 00:21'!reactividadDe: unAlelo    ^self reactividades at: unAlelo ifAbsent: [ 0 ].! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!EstudioAnticuerposPRA class	instanceVariableNames: ''!!EstudioAnticuerposPRA class methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 18:59'!conReactividades: unDiccionario	^(super new) initialize: unDiccionario; yourself.! !EstudioClinico subclass: #EstudioAptitudGeneral	instanceVariableNames: 'resultado'	classVariableNames: ''	package: 'TP1'!!EstudioAptitudGeneral methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 18:59'!initialize: unResultado	(#(#apto #noApto) includes: unResultado) ifTrue:[		resultado:= unResultado.	]ifFalse: [^self error: 'Dato mal ingresado'].^self.! !!EstudioAptitudGeneral methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 16:40'!resultado	^resultado.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!EstudioAptitudGeneral class	instanceVariableNames: ''!!EstudioAptitudGeneral class methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 18:59'!conResultado: unResultado	^(super new) initialize: unResultado; yourself.! !EstudioClinico subclass: #EstudioCrossmatch	instanceVariableNames: 'resultado donante'	classVariableNames: ''	package: 'TP1'!!EstudioCrossmatch methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 19:00'!initialize: unResultado	(#(#negativo #positivo) includes: unResultado) ifTrue:[		resultado:= unResultado.	]ifFalse: [^self error: 'Dato mal ingresado'].^self.	! !!EstudioCrossmatch methodsFor: 'as yet unclassified' stamp: 'MarcosLupotti 9/26/2025 15:58'!con: unDonante	(unDonante isKindOf: Persona) ifTrue:[		donante:= unDonante.	]ifFalse: [^self error: 'Dato mal ingresado'].^self.! !!EstudioCrossmatch methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 16:41'!resultado	^resultado.! !!EstudioCrossmatch methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 16:41'!donante	^donante.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!EstudioCrossmatch class	instanceVariableNames: ''!!EstudioCrossmatch class methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 19:00'!conResultado: unResultado	^(super new) initialize: unResultado; yourself.! !EstudioClinico subclass: #EstudioSerologicoCompleto	instanceVariableNames: 'resultado'	classVariableNames: ''	package: 'TP1'!!EstudioSerologicoCompleto methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 16:41'!resultado	^resultado.! !!EstudioSerologicoCompleto methodsFor: 'accessing' stamp: 'miqueas 10/5/2025 19:00'!initialize: unResultado	(#(#apto #noApto) includes: unResultado) ifTrue:[		resultado:= unResultado.	]ifFalse: [^self error: 'Dato mal ingresado'].^self.	! !!EstudioSerologicoCompleto methodsFor: 'accessing' stamp: 'miqueas 10/5/2025 20:47'!resultado: unResultado	(#(#apto #noApto) includes: unResultado)		ifTrue: [ resultado := unResultado ]		ifFalse: [ self error: 'Resultado inválido. Debe ser #apto o #noApto' ].! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!EstudioSerologicoCompleto class	instanceVariableNames: ''!!EstudioSerologicoCompleto class methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 20:49'!conResultado: unResultado	^self new resultado: unResultado; yourself.! !EstudioClinico subclass: #EstudioTipificacionHLA	instanceVariableNames: 'a b dR'	classVariableNames: ''	package: 'TP1'!!EstudioTipificacionHLA methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 19:00'!initialize: unaListaA b:unaListaB dR: unaListaDR	a:= unaListaA.	b:= unaListaB.	dR:= unaListaDR.^self.! !!EstudioTipificacionHLA methodsFor: 'as yet unclassified' stamp: 'Eros 10/5/2025 22:50'!alelos^a,b,dR! !!EstudioTipificacionHLA methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 16:11'!dR	^ dR! !!EstudioTipificacionHLA methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 16:11'!a	^ a! !!EstudioTipificacionHLA methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 16:11'!b	^ b! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!EstudioTipificacionHLA class	instanceVariableNames: ''!!EstudioTipificacionHLA class methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 19:01'!conA: unaListaA b:unaListaB dR: unaListaDR	^(super new) initialize: unaListaA b:unaListaB dR: unaListaDR; yourself.! !Object subclass: #EvaluadorCompatibilidad	instanceVariableNames: 'listaCriteriosDeseables listaCriteriosObligatorios'	classVariableNames: ''	package: 'TP1'!!EvaluadorCompatibilidad methodsFor: 'configuración' stamp: 'Anonymous 10/4/2025 18:16'!agregaCriterioDeseable: unCriterioDeseable conPonderacion: unNumero 	unCriterioDeseable ponderacion: unNumero.	listaCriteriosDeseables add: unCriterioDeseable.! !!EvaluadorCompatibilidad methodsFor: 'configuración' stamp: 'Eros 10/5/2025 16:29'!agregaCriterioObligatorio: unCriterioObligatorio	listaCriteriosObligatorios add: unCriterioObligatorio.! !!EvaluadorCompatibilidad methodsFor: 'configuración' stamp: 'Eros 10/20/2025 11:23'!compatibilidadPaciente: unPaciente con: unDonante    | valor fs acumulador sumaPonderaciones estudiosFaltantes resultado porcentajeCompatibilidad |        estudiosFaltantes := OrderedCollection new.    acumulador := 0.    sumaPonderaciones := 0.    "=== 1. Revisar Criterios Obligatorios (Fail-Fast) ==="    listaCriteriosObligatorios do: [:c |        fs := c estudiosFaltantes: unPaciente con: unDonante.        (fs isEmpty) ifTrue: [ "Puedo evaluar"            ((c evaluaCompatibilidad: unPaciente con: unDonante) = #noApto) ifTrue: [                "Falla por #noApto. Retorno 0 y los estudios faltantes que encontré HASTA AHORA."                resultado := ResultadoCompatibilidad                    nuevoConPaciente: unPaciente                    donante: unDonante                    porcentajeCompatibilidad: 0                    estudiosFaltantes: estudiosFaltantes.                ^ resultado            ].        ] ifFalse: [ "Falta un estudio obligatorio"            estudiosFaltantes addAll: fs.            resultado := ResultadoCompatibilidad                nuevoConPaciente: unPaciente                donante: unDonante                porcentajeCompatibilidad: 0                estudiosFaltantes: estudiosFaltantes.            ^ resultado        ].    ].    "=== 2. Evaluar Criterios Deseables ==="    listaCriteriosDeseables do: [:c |        "La sumaPonderaciones va SIEMPRE, fuera del ifFalse:"        sumaPonderaciones := sumaPonderaciones + c ponderacion.                fs := c estudiosFaltantes: unPaciente con: unDonante.                fs isNotEmpty ifTrue: [            "Si faltan estudios, solo los agrego a la lista"            estudiosFaltantes addAll: fs.        ] ifFalse: [            "Si NO faltan estudios, calculo el valor y lo sumo al acumulador"            valor := c evaluaCompatibilidad: unPaciente con: unDonante.            acumulador := acumulador + ((c ponderacion * valor) / 100).        ].    ].    "=== 3. Cálculo Final (con guarda para división por cero) ==="    (sumaPonderaciones = 0) ifTrue: [        porcentajeCompatibilidad := 0.    ] ifFalse: [        porcentajeCompatibilidad := (acumulador / sumaPonderaciones) * 100.    ].    resultado := ResultadoCompatibilidad        nuevoConPaciente: unPaciente        donante: unDonante        porcentajeCompatibilidad: porcentajeCompatibilidad        estudiosFaltantes: estudiosFaltantes.            ^ resultado.! !!EvaluadorCompatibilidad methodsFor: 'initialization' stamp: 'Eros 10/5/2025 16:13'!initialize	listaCriteriosDeseables := OrderedCollection new. 	listaCriteriosObligatorios := OrderedCollection new.^self.! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!EvaluadorCompatibilidad class	instanceVariableNames: ''!!EvaluadorCompatibilidad class methodsFor: 'instance creation' stamp: 'Eros 10/5/2025 16:40'!new^super new initialize. ! !Object subclass: #Persona	instanceVariableNames: 'dni nombre apellido peso estatura estudios fechaNacimiento fechaIngresoListaEspera donanteAsociado'	classVariableNames: ''	package: 'TP1'!!Persona methodsFor: 'acceso y modificación' stamp: 'MarcosLupotti 9/26/2025 17:07'!peso	^ peso! !!Persona methodsFor: 'acceso y modificación' stamp: 'MarcosLupotti 9/26/2025 17:06'!estatura: unaEstatura	estatura:= unaEstatura.! !!Persona methodsFor: 'acceso y modificación' stamp: 'Eros 10/5/2025 13:57'!donanteAsociado^donanteAsociado ! !!Persona methodsFor: 'acceso y modificación' stamp: 'Eros 10/5/2025 13:57'!donanteAsociado: unDonantedonanteAsociado := unDonante .! !!Persona methodsFor: 'acceso y modificación' stamp: 'MarcosLupotti 9/26/2025 17:06'!peso: unPeso	peso:= unPeso.! !!Persona methodsFor: 'acceso y modificación' stamp: 'Eros 10/5/2025 14:59'!fechaNacimiento^fechaNacimiento ! !!Persona methodsFor: 'acceso y modificación' stamp: 'willy 9/16/2025 15:55'!estatura	^ estatura! !!Persona methodsFor: 'acceso y modificación' stamp: 'Eros 10/5/2025 15:10'!fechaFormateada    ^ fechaNacimiento ifNotNil: [ fechaNacimiento yyyymmdd ] ifNil: [ 'N/A' ].! !!Persona methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 17:07'!nombre: unNombre	nombre := unNombre.! !!Persona methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 17:07'!apellido: unApellido	apellido := unApellido.! !!Persona methodsFor: 'accessing' stamp: 'ErosFaccioli 10/2/2025 18:59'!fechaIngresoListaEspera^fechaIngresoListaEspera ! !!Persona methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 17:07'!dni: unDNI	dni := unDNI.! !!Persona methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 17:07'!nombre	^ nombre! !!Persona methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 17:07'!dni	^ dni! !!Persona methodsFor: 'accessing' stamp: 'Anonymous 10/4/2025 23:15'!edad "Devuelve la edad de la persona en años, calculada según la fecha actual."	| hoy años |	hoy := Date today.	años := hoy year - fechaNacimiento year.	(hoy month < fechaNacimiento month 		or: [hoy month = fechaNacimiento month 			and: [hoy day < fechaNacimiento day]]) ifTrue: [		años := años - 1	].	^años! !!Persona methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 17:07'!apellido	^ apellido! !!Persona methodsFor: 'accessing' stamp: 'MarcosLupotti 9/26/2025 17:11'!estudios	^estudios.! !!Persona methodsFor: 'accessing' stamp: 'ErosFaccioli 10/2/2025 18:59'!fechaIngresoListaEspera: unaFechafechaIngresoListaEspera := unaFecha .! !!Persona methodsFor: 'gestión de estudios clínicos' stamp: 'miqueas 10/5/2025 20:27'!registraEstudio: unEstudioClinico con: unaPersona	estudios add: (unEstudioClinico con: unaPersona).! !!Persona methodsFor: 'gestión de estudios clínicos' stamp: 'MarcosLupotti 9/26/2025 17:07'!registraEstudio: unEstudioClinico 	estudios add: unEstudioClinico.! !!Persona methodsFor: 'initialization' stamp: 'miqueas 10/5/2025 19:01'!initialize: unDNI nombre: unNombre apellido: unApellido fechaNacimiento: unaFecha	estudios := OrderedCollection new.	dni:= unDNI.	nombre:= unNombre.	apellido:= unApellido.	fechaNacimiento:= unaFecha.	fechaIngresoListaEspera := nil. ^self.	! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Persona class	instanceVariableNames: ''!!Persona class methodsFor: 'as yet unclassified' stamp: 'miqueas 10/5/2025 19:01'!conDni: unDNI nombre: unNombre apellido: unApellido fechaNacimiento: unaFecha	^(super new) initialize: unDNI nombre: unNombre apellido: unApellido fechaNacimiento: unaFecha; yourself.! !Object subclass: #ResultadoCompatibilidad	instanceVariableNames: 'paciente donante porcentajeCompatibilidad estudiosFaltantes'	classVariableNames: 'MinimoCompatibilidad'	package: 'TP1'!!ResultadoCompatibilidad methodsFor: 'accessing' stamp: 'Marcos 10/20/2025 21:53'!compatible	| min por |	min:= self class minimoCompatibilidad.	por:= self porcentajeCompatibilidad.^(por >= min).! !!ResultadoCompatibilidad methodsFor: 'Inicialización' stamp: 'MiqueasVera 10/3/2025 16:19'!donante: unDonante	donante := unDonante! !!ResultadoCompatibilidad methodsFor: 'Inicialización' stamp: 'MiqueasVera 10/3/2025 16:19'!porcentajeCompatibilidad: unNumero	porcentajeCompatibilidad := unNumero! !!ResultadoCompatibilidad methodsFor: 'Inicialización' stamp: 'MiqueasVera 10/3/2025 16:19'!estudiosFaltantes: unaLista	estudiosFaltantes := unaLista! !!ResultadoCompatibilidad methodsFor: 'Inicialización' stamp: 'MiqueasVera 10/3/2025 16:18'!paciente: unPaciente	paciente := unPaciente! !!ResultadoCompatibilidad methodsFor: 'Acceso' stamp: 'MiqueasVera 10/3/2025 16:18'!estudiosFaltantes	^ estudiosFaltantes! !!ResultadoCompatibilidad methodsFor: 'Acceso' stamp: 'MiqueasVera 10/3/2025 16:17'!porcentajeCompatibilidad^ porcentajeCompatibilidad! !!ResultadoCompatibilidad methodsFor: 'Acceso' stamp: 'MiqueasVera 10/3/2025 16:16'!paciente^ paciente! !!ResultadoCompatibilidad methodsFor: 'Acceso' stamp: 'MiqueasVera 10/3/2025 16:16'!donante^ donante! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!ResultadoCompatibilidad class	instanceVariableNames: ''!!ResultadoCompatibilidad class methodsFor: 'Configuración' stamp: 'Marcos 10/20/2025 21:49'!minimoCompatibilidad    ^ MinimoCompatibilidad ifNil: [ MinimoCompatibilidad := 50 ].  "default"! !!ResultadoCompatibilidad class methodsFor: 'Configuración' stamp: 'Marcos 10/20/2025 21:48'!minimoCompatibilidad: unNumero	MinimoCompatibilidad := unNumero.! !!ResultadoCompatibilidad class methodsFor: 'creación de instancia' stamp: 'MiqueasVera 10/3/2025 16:15'!nuevoConPaciente: unPaciente donante: unDonante porcentajeCompatibilidad: unPorcentaje estudiosFaltantes: unaListaNombresDeEstudios^ self new paciente: unPaciente; donante: unDonante; porcentajeCompatibilidad: unPorcentaje; estudiosFaltantes: unaListaNombresDeEstudios; yourself! !